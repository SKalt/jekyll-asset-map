{% capture result %}
  {% if include.entrypoints %}
    {% assign sep = include.sep | default: "," %}
    {% assign entrypoints = include.entrypoints | split: sep %}
    {% assign asset_map_name = include.asset_map_name | default: "manifest" %}
    {% assign asset_map = site.data[asset_map_name] %}
    {% assign asset_key = include.asset_key | default: "js" %}
    {% if asset_map %}
      {% assign entrypoint_key = include.entrypoint_key | default: "entrypoints" %}
      {% assign entrypoint_map = asset_map[entrypoint_key] %}
      {% if entrypoint_map %}
        {% assign _entrypoints = "" | split: "" %}
        {% for entrypoint in entrypoints %}
          {% assign _entrypoints = _entrypoints | push: entrypoint_map[entrypoint] %}
        {% endfor %}
        {% assign chunks = _entrypoints | map: asset_key | uniq %}
      {% else %}
        {% include asset_map_error.html
            message="Error! No entrypoint map found"
            error=include.error
        %}
      {% endif %}
      {% for chunk in chunks %}{%
        assign src = chunk.path
          | default: chunk.src
          | default: chunk.href
          | default: chunk.asset
          | default: chunk
        %}{%
          if src
          %}{%
            assign bools = "async,defer,nomodule" | split: ","
            %}<script src="{{ src }}"{%
            for _bool in bools
            %}{%
              if include[_bool]
                %} {{ _bool }}{%
              endif
              %}{%
            endfor
          %}{%
            if chunk.integrity
          %} integrity="{{ chunk.integrity }}"{%
            endif
          %}{%
            if include.type
          %} type="{{ include.type }}"{%
            endif
          %}></script>{%
            else
          %}{% include asset_map_error.html message="WARNING! no useable source for chunk {{ chunk }}" error=include.error %}{%
          endif
        %}{%
        endfor
      %}
    {% else %}
      {% include asset_map_error.html message="WARNING! no asset map named {{ asset_map_name }}" error=include.error %}
    {% endif %}
  {% else %}
   {% include asset_map_error.html
      message="WARNING: no entrypoints supplied"
      error=include.error
    %}
  {% endif %}
{% endcapture %}{{ result | strip }}