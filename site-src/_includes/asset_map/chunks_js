{% capture result %}
  {% if include.entrypoints %}
    {% assign sep = include.sep | default: "," %}
    {% assign entrypoints = include.entrypoints | split: sep %}
    {% assign asset_map_name = include.map | default: "manifest" %}
    {% assign asset_map = site.data[asset_map_name] %}
    {% assign asset_key = include.asset_key | default: "js" %}
    {% if asset_map %}
      {% assign entrypoint_key = include.entrypoint_key | default: "entrypoints" %}
      {% assign entrypoint_map = asset_map[entrypoint_key] %}
      {% if entrypoint_map %}
        {% assign _entrypoints = "" | split: "" %}
        {% for entrypoint in entrypoints %}
          {% assign _entrypoints = _entrypoints | push: entrypoint_map[entrypoint] %}
        {% endfor %}
        {% assign chunks = _entrypoints | map: asset_key | uniq %}
      {% else %}
        {% include asset_map/error
            message="Error! No entrypoint map found"
            error=include.error
        %}
      {% endif %}
      {% for chunk in chunks %}{%
        assign src = chunk.path
          | default: chunk.src
          | default: chunk.href
          | default: chunk.asset
          | default: chunk
        %}{%
          if src
          %}{%
            assign bools = "async,defer,nomodule" | split: ","
            %}{%
            assign echoed = "type,crossorigin,referrerpolicy" | split: ","
            %}<script src="{{ src }}"{%
            if chunk.integrity and chunk.integrity != ""
          %} integrity="{{ chunk.integrity }}"{%
            endif
          %}{%
            for attr in echoed %}{%
              if include[attr] %} {{ attr }}="{{ include[attr] }}"{% endif %}{%
            endfor
            %}{%
            for attr in bools
            %}{%
              if include[attr] %} {{ attr }}{% endif %}{%
            endfor
          %}></script>{%
            else
          %}{%
              capture message
                %}WARNING! no useable source for chunk {{ chunk }}{%
              endcapture
            %}{%
              include asset_map/error message=message error=include.error
              %}{%
          endif
        %}{%
        endfor
      %}
    {% else %}
      {% capture message %}WARNING! no asset map named {{ asset_map_name }}{% endcapture %}
      {% include asset_map/error message=message error=include.error %}
    {% endif %}
  {% else %}
   {% include asset_map/error
      message="WARNING: no entrypoints supplied"
      error=include.error
    %}
  {% endif %}
{% endcapture %}{{ result | strip }}